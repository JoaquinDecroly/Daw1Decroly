DROP DATABASE IF EXISTS DAWBANK;
CREATE DATABASE DAWBANK;
USE DAWBANK;

CREATE TABLE CUENTABANCARIA(
    IBAN VARCHAR(24) PRIMARY KEY,
    TITULAR VARCHAR(40) UNIQUE,
    SALDO DECIMAL(8,2)
);

CREATE TABLE MOVIMIENTOS(
    ID INT AUTO_INCREMENT PRIMARY KEY,
    IBAN VARCHAR(24) UNIQUE,
    TITULAR VARCHAR(40),
    FECHA DATE,
    CANTIDAD DECIMAL(8,2),
    MOVIMIENTO_JSON JSON,
     FOREIGN KEY (IBAN) REFERENCES CUENTABANCARIA(IBAN),
      FOREIGN KEY (TITULAR) REFERENCES CUENTABANCARIA(TITULAR)
);

-- Inserción de datos en la tabla CUENTABANCARIA
INSERT INTO CUENTABANCARIA (IBAN, TITULAR, SALDO) 
VALUES ('ES1234567891012131415167', 'PEDRO SALAZAR', 50);

-- Inserción de datos en la tabla MOVIMIENTOS
INSERT INTO MOVIMIENTOS (IBAN, TITULAR, MOVIMIENTO_JSON) 
VALUES 
    ('ES1234567891012131415167', 'PEDRO SALAZAR', JSON_ARRAY(
        JSON_OBJECT('ID', '1','FECHA', '2023-10-01', 'TIPO', 'INGRESO', 'CANTIDAD', 100.00),
        JSON_OBJECT('ID', '2', 'FECHA', '2023-10-05', 'TIPO', 'RETIRADA', 'CANTIDAD', 50.00)
    ));
SELECT * FROM CUENTABANCARIA;
SELECT * FROM MOVIMIENTOS;
-- grant select to dawbank.movimientos for root;
